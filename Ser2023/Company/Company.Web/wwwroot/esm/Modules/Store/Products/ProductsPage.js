import{A as E,K as k,N as g,O as C,da as D,e as b,z as x}from"../../../_chunks/chunk-NQNNAIF5.js";import{a as m,c as y,d as P,f as I,g as S}from"../../../_chunks/chunk-FEDAVPE7.js";var w=y(I(),1);var d=y(S(),1),t=y(I(),1),f=y(x(),1);var l=g.Fields,p=class extends d.EntityGrid{constructor(e){super(e);this.pendingChanges={}}getColumnsKey(){return k.columnsKey}getDialogType(){return E}getIdProperty(){return g.idProperty}getInsertPermission(){return g.insertPermission}getLocalTextPrefix(){return g.localTextPrefix}getService(){return C.baseUrl}getQuickFilters(){var e=super.getQuickFilters(),n=(0,t.parseQueryString)();if(n.cat){var a=(0,t.tryFirst)(e,i=>i.field=="CategoryId");a.init=i=>{i.element.getWidget(d.LookupEditor).value=n.cat}}return e.push({type:d.LookupEditor,options:{lookupKey:D.lookupKey},field:"WaresID",title:"Contains Wares in Details",handler:i=>{this.view.params.WaresId=(0,t.toId)(i.value)},cssClass:"hidden-xs"}),e}getButtons(){var e=super.getButtons();return e.push(f.ExcelExportHelper.createToolButton({title:"Export To Excel",grid:this,service:C.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),e.push(f.PdfExportHelper.createToolButton({grid:this,onViewSubmit:()=>this.onViewSubmit(),reportTitle:"Product List",columnTitles:{Discontinued:"Dis."},tableOptions:{columnStyles:{ProductID:{columnWidth:25,halign:"right"},Discountinued:{columnWidth:25}}}})),e.push({title:"Save Changes",cssClass:"apply-changes-button disabled",onClick:n=>this.saveClick(),separator:!0}),e}onViewProcessData(e){return this.pendingChanges={},this.setSaveButtonState(),super.onViewProcessData(e)}numericInputFormatter(e){var n="edit numeric",a=e.item,i=this.pendingChanges[a.ProductId];i&&i[e.column.field]!==void 0&&(n+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' class='"+n+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.####")+"'/>"}moneyInputFormatter(e){var n="edit numeric",a=e.item,i=this.pendingChanges[a.ProductId];i&&i[e.column.field]!==void 0&&(n+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' style='text - align:right' class='"+n+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.0000")+"'/>"}stringInputFormatter(e){var n="edit string",a=e.item,i=this.pendingChanges[a.ProductId],s=e.column;i&&i[s.field]!==void 0&&(n+=" dirty");var r=this.getEffectiveValue(a,s.field);return"<input type='text' class='"+n+"' data-field='"+s.field+"' value='"+(0,t.attrEncode)(r)+"' maxlength='"+s.sourceItem.maxLength+"'/>"}selectFormatter(e,n,a){var i="edit",s=e.item,r=this.pendingChanges[s.ProductId],v=e.column;r&&r[n]!==void 0&&(i+=" dirty");var h=this.getEffectiveValue(s,n),u="<select class='"+i+"' data-field='"+n+"' style='width: 100%; max-width: 100%'>";for(var o of a.items){let c=o[a.idField];u+="<option value='"+(0,t.attrEncode)(c)+"'",c==h&&(u+=" selected"),u+=">"+(0,t.htmlEncode)(o[a.textField])+"</option>"}return u+"</select>"}getEffectiveValue(e,n){var a=this.pendingChanges[e.ProductID];return a&&a[n]!==void 0?a[n]:e[n]}getColumns(){var e=super.getColumns(),n=m(r=>this.numericInputFormatter(r),"num"),a=m(r=>this.stringInputFormatter(r),"str"),i=m(r=>this.moneyInputFormatter(r),"mon");(0,t.first)(e,r=>r.field==="QuantityPerUnit").format=a;var s=(0,t.first)(e,r=>r.field===l.CategoryName);return s.referencedFields=[l.CategoryId],s.format=r=>this.selectFormatter(r,l.CategoryId,b.getLookup()),(0,t.first)(e,r=>r.field===l.UnitPrice).format=i,(0,t.first)(e,r=>r.field==l.UnitPrice).cssClass+=" col-unit-price",(0,t.first)(e,r=>r.field===l.SalePrice).format=i,(0,t.first)(e,r=>r.field==l.SalePrice).cssClass+=" col-unit-price",(0,t.first)(e,r=>r.field===l.UnitsInStock).format=n,(0,t.first)(e,r=>r.field===l.UnitsOnOrder).format=n,(0,t.first)(e,r=>r.field===l.ReorderLevel).format=n,e}inputsChange(e){var n=this.slickGrid.getCellFromEvent(e),a=this.itemAt(n.row),i=$(e.target),s=i.data("field"),r=(0,t.coalesce)((0,t.trimToNull)(i.val()),"0"),v=this.pendingChanges[a.ProductId],h=this.getEffectiveValue(a,s),u;i.hasClass("numeric")?u=(0,t.formatNumber)(h,"0.####"):u=h;var o;if(s==="UnitPrice"){if(o=(0,t.parseDecimal)(r),o==null||isNaN(o)){(0,t.notifyError)(r("Validation.Decimal"),"",null),i.val(u),i.focus();return}}else if(i.hasClass("numeric")){var c=(0,t.parseInteger)(r);if(isNaN(c)||c>32767||c<0){(0,t.notifyError)(r("Validation.Integer"),"",null),i.val(u),i.focus();return}o=c}else o=r;v||(this.pendingChanges[a.ProductId]=v={}),v[s]=o,a[s]=o,this.view.refresh(),i.hasClass("numeric")&&(o=(0,t.formatNumber)(o,"0.####")),i.val(o).addClass("dirty"),this.setSaveButtonState()}onClick(e,n,a){if(super.onClick(e,n,a),!e.isDefaultPrevented()){var i=this.itemAt(n),s=$(e.target);s.parent().hasClass("inline-action")&&(s=s.parent()),s.hasClass("inline-action")&&(e.preventDefault(),s.hasClass("print-invoice")&&f.ReportHelper.execute({reportKey:"Northwind.OrderDetail",params:{ProductId:i.ProductId}}))}}setSaveButtonState(){this.toolbar.findButton("apply-changes-button").toggleClass("disabled",Object.keys(this.pendingChanges).length===0)}saveClick(){if(Object.keys(this.pendingChanges).length!==0){var e=Object.keys(this.pendingChanges),n=-1,a=this;m(function i(){if(++n>=e.length){a.refresh();return}var s=e[n],r=(0,t.deepClone)(a.pendingChanges[s]);r.ProductID=s,(0,t.serviceRequest)("Store/Product/Update",{EntityId:s,Entity:r},v=>{delete a.pendingChanges[s],i()})},"saveNext")()}}};m(p,"ProductsGrid"),p=P([d.Decorators.registerClass("Company.Store.ProductsGrid"),d.Decorators.filterable()],p);$(function(){(0,w.initFullHeightGridPage)(new p($("#GridDiv")).element)});
//# sourceMappingURL=ProductsPage.js.map
