import{u as P,v as g,w as k,z as I}from"../../../_chunks/chunk-6WQISPJW.js";import{a as c,b as E,c as h,d as y,f as C,g as F}from"../../../_chunks/chunk-FEDAVPE7.js";var S=E((T,D)=>{D.exports=Slick});var b=h(C(),1);var v=h(F(),1);var r=h(C(),1),w=h(S(),1);var p=g.Fields,d=class extends v.EntityGrid{constructor(e){super(e);this.pendingChanges={};this.slickContainer.on("change",".edit:input",i=>this.inputsChange(i))}getColumnsKey(){return P.columnsKey}getDialogType(){return I}getIdProperty(){return g.idProperty}getInsertPermission(){return g.insertPermission}getLocalTextPrefix(){return g.localTextPrefix}getService(){return k.baseUrl}getButtons(){var e=super.getButtons();return e.push({title:"Save Changes",cssClass:"apply-changes-button disabled",onClick:i=>this.saveClick(),separator:!0}),e}numericInputFormatter(e){var i="edit numeric",a=e.item,n=this.pendingChanges[a.WaresId];n&&n[e.column.field]!==void 0&&(i+=" dirty");var t=this.getEffectiveValue(a,e.column.field);return"<input type='text' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,r.formatNumber)(t,"0.####")+"'/>"}moneyInputFormatter(e){var i="edit numeric",a=e.item,n=this.pendingChanges[a.WaresId];n&&n[e.column.field]!==void 0&&(i+=" dirty");var t=this.getEffectiveValue(a,e.column.field);return"<input type='text' style='text - align:right' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,r.formatNumber)(t,"0.0000")+"'/>"}stringInputFormatter(e){var i="edit string",a=e.item,n=this.pendingChanges[a.WaresId],t=e.column;n&&n[t.field]!==void 0&&(i+=" dirty");var s=this.getEffectiveValue(a,t.field);return"<input type='text' class='"+i+"' data-field='"+t.field+"' value='"+(0,r.attrEncode)(s)+"' maxlength='"+t.sourceItem.maxLength+"'/>"}selectFormatter(e,i,a){var n="edit",t=e.item,s=this.pendingChanges[t.WaresId],m=e.column;s&&s[i]!==void 0&&(n+=" dirty");var f=this.getEffectiveValue(t,i),l="<select class='"+n+"' data-field='"+i+"' style='width: 100%; max-width: 100%'>";for(var o of a.items){let u=o[a.idField];l+="<option value='"+(0,r.attrEncode)(u)+"'",u==f&&(l+=" selected"),l+=">"+(0,r.htmlEncode)(o[a.textField])+"</option>"}return l+"</select>"}getEffectiveValue(e,i){var a=this.pendingChanges[e.WaresID];return a&&a[i]!==void 0?a[i]:e[i]}inputsChange(e){var i=this.slickGrid.getCellFromEvent(e),a=this.itemAt(i.row),n=$(e.target),t=n.data("field"),s=(0,r.coalesce)((0,r.trimToNull)(n.val()),"0"),m=this.pendingChanges[a.WaresId],f=this.getEffectiveValue(a,t),l;n.hasClass("numeric")?l=(0,r.formatNumber)(f,"0.####"):l=f;var o;if(t==="UnitPrice"){if(o=(0,r.parseDecimal)(s),o==null||isNaN(o)){(0,r.notifyError)(s("Validation.Decimal"),"",null),n.val(l),n.focus();return}}else if(n.hasClass("numeric")){var u=(0,r.parseInteger)(s);if(isNaN(u)||u>32767||u<0){(0,r.notifyError)(s("Validation.Integer"),"",null),n.val(l),n.focus();return}o=u}else o=s;m||(this.pendingChanges[a.ProductId]=m={}),m[t]=o,a[t]=o,this.view.refresh(),n.hasClass("numeric")&&(o=(0,r.formatNumber)(o,"0.####")),n.val(o).addClass("dirty"),this.setSaveButtonState()}setSaveButtonState(){this.toolbar.findButton("apply-changes-button").toggleClass("disabled",Object.keys(this.pendingChanges).length===0)}saveClick(){if(Object.keys(this.pendingChanges).length!==0){var e=Object.keys(this.pendingChanges),i=-1,a=this;c(function n(){if(++i>=e.length){a.refresh();return}var t=e[i],s=(0,r.deepClone)(a.pendingChanges[t]);s.ProductID=t,(0,r.serviceRequest)("Store/Product/Update",{EntityId:t,Entity:s},m=>{delete a.pendingChanges[t],n()})},"saveNext")()}}createSlickGrid(){var e=super.createSlickGrid();return e.registerPlugin(new Slick.Data.GroupItemMetadataProvider),this.view.setSummaryOptions({aggregators:[new w.Aggregators.Sum(p.LineTotal)]}),e}getColumns(){var e=super.getColumns(),i=c(t=>this.numericInputFormatter(t),"num"),a=c(t=>this.stringInputFormatter(t),"str"),n=c(t=>this.moneyInputFormatter(t),"mon");return(0,r.first)(e,t=>t.field===p.PlanPrice).format=n,(0,r.first)(e,t=>t.field==p.PlanPrice).cssClass+=" col-unit-price",(0,r.first)(e,t=>t.field===p.Quantity).format=i,(0,r.first)(e,t=>t.field===p.ProductQuantity).format=i,(0,r.first)(e,t=>t.field===p.LineTotal).groupTotalsFormatter=(t,s)=>t.sum?"Sum: "+(0,r.coalesce)(t.sum[s.field],""):"",e}getSlickOptions(){var e=super.getSlickOptions();return e.showFooterRow=!0,e}usePager(){return!1}};c(d,"ProductDetailsGrid"),d=y([v.Decorators.registerClass("Company.Store.ProductDetailsGrid"),v.Decorators.filterable()],d);$(function(){(0,b.initFullHeightGridPage)(new d($("#GridDiv")).element)});
//# sourceMappingURL=ProductDetailsPage.js.map
