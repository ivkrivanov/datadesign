import{a as G}from"../../../_chunks/chunk-ZOEJ2HZL.js";import{a as V}from"../../../_chunks/chunk-IUICKFWK.js";import{$ as M,aa as z,ba as y,ca as O,da as Q}from"../../../_chunks/chunk-NQNNAIF5.js";import{a as o,c as C,d as E,f as R,g as N}from"../../../_chunks/chunk-FEDAVPE7.js";var X=C(R(),1);var m=C(N(),1),J=C(R(),1);var I=C(N(),1);var U=C(R(),1);var D;(t=>{function k(i){var d,c;return{title:(d=i.title)!=null?d:"Report",cssClass:(c=i.cssClass)!=null?c:"print-button",icon:i.icon,onClick:()=>{t.execute(i)}}}t.createToolButton=k,o(k,"createToolButton");function j(i){var c,f;var d=i.getParams?i.getParams():i.params;(0,U.postToUrl)({url:"~/Serenity.Extensions/Report/"+(i.download?"Download":"Render"),params:{key:i.reportKey,ext:(c=i.extension)!=null?c:"pdf",opt:d?JSON.stringify(d):""},target:(f=i.target)!=null?f:"_blank"})}t.execute=j,o(j,"execute")})(D||(D={}));var b=class extends I.EntityDialog{constructor(){super(...arguments);this.form=new z(this.idPrefix)}getFormKey(){return z.formKey}getRowDefinition(){return y}getService(){return O.baseUrl}getToolbarButtons(){var t=super.getToolbarButtons();return t.push(D.createToolButton({title:"Invoice",cssClass:"export-pdf-button",reportKey:"Northwind.OrderDetail",getParams:()=>({WaresOrderID:this.entityId})})),t}updateInterface(){super.updateInterface(),this.toolbar.findButton("export-pdf-button").toggle(this.isEditMode())}};o(b,"WaresOrderDialog"),b=E([I.Decorators.registerClass("Company.Store.WaresOrderDialog")],b);var a=C(R(),1);var B;(f=>{function k(e,s,l){return e.map(u=>{let n={dataKey:u.id||u.field,title:u.name||""};l&&l[n.dataKey]!=null&&(n.title=l[n.dataKey]);let p={};return(u.cssClass||"").indexOf("align-right")>=0?p.halign="right":(u.cssClass||"").indexOf("align-center")>=0&&(p.halign="center"),s[n.dataKey]=p,n})}o(k,"toAutoTableColumns");function j(e,s,l,u){let n=document.createElement("span"),p=0;return s.map(x=>{let r=[];for(let P=0;P<u.length;P++){var w=u[P],F=e.getFormatter(p,w),T=e.getFormatterContext(p,P);T.item=x,T.value=x[w.field];let g=F?F(T):"";!g||g.indexOf("<")<0&&g.indexOf("&")<0?r.push(g):(n.innerHTML=g,n.children.length==1&&$(n.children[0]).is("select")?r.push($(n.children[0]).children("[selected]").text()):n.children.length==1&&$(n.children[0]).is(":input")?r.push($(n.children[0]).val()):n.children.length==1&&$(n.children).is(".check-box")?r.push($(n.children).hasClass("checked")?"X":""):r.push(n.textContent||""))}return p++,r})}o(j,"toAutoTableData");function t(e){var s=e.grid;if(e.onViewSubmit()){c();var l=(0,a.deepClone)(s.view.params);l.Take=0,l.Skip=0;var u=s.view.sortBy;u!=null&&(l.Sort=u);var n=s.slickGrid.getColumns();n=n.filter(x=>x.id!=="__select__"),l.IncludeColumns=[];for(var p of n)l.IncludeColumns.push(p.id||p.field);(0,a.serviceCall)({url:s.view.url,request:l,onSuccess:x=>{let r=new jsPDF("l","pt"),w=n,F={},T=k(w,F,e.columnTitles);var P=T.map(h=>h.dataKey);let g=x.Entities||[],Y=j(s.slickGrid,g,P,w);r.setFontSize(e.titleFontSize||10),r.setFont("helvetica","bold");let Z=e.reportTitle||s.getTitle()||"Report";r.autoTableText(Z,r.internal.pageSize.width/2,e.titleTop||25,{halign:"center"});var _="{{T}}";let q=e.pageNumbers==null||e.pageNumbers;var S=$.extend({margin:{top:25,left:25,right:25,bottom:q?25:30},startY:60,styles:{fontSize:8,overflow:"linebreak",cellPadding:2,valign:"middle"},columnStyles:F},e.tableOptions),K,W;if(q&&(K=o(function(h){var L=h.pageCount;typeof r.putTotalPages=="function"&&(L=L+" / "+_),r.autoTableText(L,r.internal.pageSize.width/2,r.internal.pageSize.height-S.margin.bottom,{halign:"center"})},"footer")),(e.printDateTimeHeader==null||e.printDateTimeHeader)&&(W=o(function(h){r.setFont("helvetica","normal"),r.setFontSize(8),r.autoTableText((0,a.formatDate)(new Date,"dd-MM-yyyy HH:mm"),r.internal.pageSize.width-S.margin.right,13,{halign:"right"})},"header")),S.didDrawPage=h=>{W&&W(h),K&&K(h)},S.head=[T],S.body=Y,r.autoTable(S),typeof r.putTotalPages=="function"&&r.putTotalPages(_),!e.output||e.output=="file"){var A=e.fileName||e.reportTitle||"{0}_{1}.pdf";A=(0,a.format)(A,s.getTitle()||"report",(0,a.formatDate)(new Date,"yyyyMMdd_HHmm")),r.save(A);return}e.autoPrint&&r.autoPrint();var H=e.output;H=="newwindow",H="dataurlnewwindow",r.output(H)}})}}f.exportToPdf=t,o(t,"exportToPdf");function i(e){return{title:e.title||"",hint:e.hint||"PDF",cssClass:"export-pdf-button",onClick:()=>t(e),separator:e.separator}}f.createToolButton=i,o(i,"createToolButton");function d(){if(typeof jsPDF=="undefined"){var e=$("jsPDFScript");e.length>0||($("<script/>").attr("type","text/javascript").attr("id","jsPDFScript").attr("src",(0,a.resolveUrl)("~/Serenity.Assets/Scripts/jspdf.min.js")).appendTo(document.head),typeof jsPDF=="undefined"&&typeof jspdf!="undefined"&&(window.jsPDF=jspdf.jsPDF))}}o(d,"includeJsPDF");function c(){if(d(),!(typeof jsPDF=="undefined"||typeof jsPDF.API=="undefined"||typeof jsPDF.API.autoTable!="undefined")){var e=$("jsPDFAutoTableScript");e.length>0||$("<script/>").attr("type","text/javascript").attr("id","jsPDFAutoTableScript").attr("src",(0,a.resolveUrl)("~/Serenity.Assets/Scripts/jspdf.plugin.autotable.min.js")).appendTo(document.head)}}o(c,"includeAutoTable")})(B||(B={}));var ee=y.Fields,v=class extends m.EntityGrid{getColumnsKey(){return M.columnsKey}getDialogType(){return b}getIdProperty(){return y.idProperty}getInsertPermission(){return y.insertPermission}getLocalTextPrefix(){return y.localTextPrefix}getService(){return O.baseUrl}getQuickFilters(){var t=super.getQuickFilters();return t.push({type:m.LookupEditor,options:{lookupKey:Q.lookupKey},field:"WaresOrderID",title:"Contains Wares in Details",handler:i=>{this.view.params.WaresId=(0,J.toId)(i.value)},cssClass:"hidden-xs"}),t}createQuickFilters(){super.createQuickFilters(),this.shippingStateFilter=this.findQuickFilter(m.EnumEditor,ee.ShippingState)}getButtons(){var t=super.getButtons();return t.push(G.createToolButton({grid:this,service:O.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),t.push(B.createToolButton({grid:this,onViewSubmit:()=>this.onViewSubmit()})),t.push({title:"Warehouse",cssClass:"export-xlsx-button",onClick:()=>{var i=new V;i.element.on("dialogclose",()=>{this.refresh(),i=null}),i.dialogOpen()}}),t}getColumns(){var t=super.getColumns();return t.splice(1,0,{id:"Print Invoice",field:null,name:"",cssClass:"align-center",format:i=>'<a class="inline-action print-invoice" title="invoice"><i class="fa fa-file-pdf-o text-red"></i></a>',width:24,minWidth:24,maxWidth:24}),t}onClick(t,i,d){if(super.onClick(t,i,d),!t.isDefaultPrevented()){var c=this.itemAt(i),f=$(t.target);f.parent().hasClass("inline-action")&&(f=f.parent()),f.hasClass("inline-action")&&(t.preventDefault(),f.hasClass("print-invoice")&&D.execute({reportKey:"Store.WaresOrderDetail",params:{WaresOrderID:c.WaresOrderId}}))}}set_shippingState(t){this.shippingStateFilter.value=t==null?"":t.toString()}addButtonClick(){var t=this.view.params.EqualityFilter;this.editItem({CounterpartyID:t?t.CounterpartyID:null})}};o(v,"WaresOrderGrid"),v=E([m.Decorators.registerClass(),m.Decorators.filterable()],v);$(function(){(0,X.initFullHeightGridPage)(new v($("#GridDiv")).element)});
//# sourceMappingURL=WaresOrderPage.js.map
