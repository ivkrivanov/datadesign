import{I as S,J as D,K as u,L as h,a as V,f as k,m as E}from"../../../_chunks/chunk-MM7FEJZM.js";import{a as m,c as y,d as w,f as b,g as F}from"../../../_chunks/chunk-FEDAVPE7.js";var W=y(b(),1);var v=y(F(),1),t=y(b(),1),P=y(V(),1);var I=y(F(),1);var g=class extends I.EntityDialog{constructor(){super(...arguments);this.form=new D(this.idPrefix)}getFormKey(){return D.formKey}getIdProperty(){return u.idProperty}getLocalTextPrefix(){return u.localTextPrefix}getNameProperty(){return u.nameProperty}getService(){return h.baseUrl}getDeletePermission(){return u.deletePermission}getInsertPermission(){return u.insertPermission}getUpdatePermission(){return u.updatePermission}};m(g,"WaresDialog"),g=w([I.Decorators.registerClass("Store.Store.WaresDialog")],g);var d=u.Fields,f=class extends v.EntityGrid{constructor(e){super(e);this.pendingChanges={};this.slickContainer.on("change",".edit:input",i=>this.inputsChange(i))}getColumnsKey(){return S.columnsKey}getDialogType(){return g}getIdProperty(){return u.idProperty}getInsertPermission(){return u.insertPermission}getLocalTextPrefix(){return u.localTextPrefix}getService(){return h.baseUrl}getButtons(){var e=super.getButtons();return e.push(P.ExcelExportHelper.createToolButton({grid:this,service:h.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),e.push(P.PdfExportHelper.createToolButton({grid:this,onViewSubmit:()=>this.onViewSubmit(),reportTitle:"Wares List",columnTitles:{Discontinued:"Dis."},tableOptions:{columnStyles:{ProductID:{cellWidth:25,halign:"right"},Discountinued:{cellWidth:25}}}})),e.push({title:"Save Changes",cssClass:"apply-changes-button disabled",onClick:i=>this.saveClick(),separator:!0}),e}onViewProcessData(e){return this.pendingChanges={},this.setSaveButtonState(),super.onViewProcessData(e)}numericInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)((0,t.formatNumber)(e.value,"#0.##"));var i="edit numeric",a=e.item,r=this.pendingChanges[a.WaresId];r&&r[e.column.field]!==void 0&&(i+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.##")+"'/>"}moneyInputFormatter(e){var i="edit numeric",a=e.item,r=this.pendingChanges[a.WaresId];r&&r[e.column.field]!==void 0&&(i+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' style='text - align:right' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.0000")+"'/>"}stringInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var i="edit string",a=e.item,r=this.pendingChanges[a.WaresId],s=e.column;r&&r[s.field]!==void 0&&(i+=" dirty");var o=this.getEffectiveValue(a,s.field);return"<input type='text' class='"+i+"' data-field='"+s.field+"' value='"+(0,t.htmlEncode)(o)+"' maxlength='"+s.sourceItem.maxLength+"'/>"}selectFormatter(e,i,a){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var r="edit",s=e.item,o=this.pendingChanges[s.WaresId],n=e.column;o&&o[i]!==void 0&&(r+=" dirty");var C=this.getEffectiveValue(s,i),p="<select class='"+r+"' data-field='"+i+"' style='width: 100%; max-width: 100%'><option value=''>--</option>";for(var l of a.items){let c=l[a.idField];p+="<option value='"+(0,t.htmlEncode)(c)+"'",c==C&&(p+=" selected"),p+=">"+(0,t.htmlEncode)(l[a.textField])+"</option>"}return p+"</select>"}getEffectiveValue(e,i){var a=this.pendingChanges[e.WaresID];return a&&a[i]!==void 0?a[i]:e[i]}getColumns(){var e=super.getColumns(),i=m(n=>this.numericInputFormatter(n),"num"),a=m(n=>this.stringInputFormatter(n),"str"),r=m(n=>this.moneyInputFormatter(n),"mon");(0,t.first)(e,n=>n.field==="QuantityPerUnit").format=a;var s=(0,t.first)(e,n=>n.field===d.CategoryCategoryName);s.referencedFields=[d.CategoryId],s.format=n=>this.selectFormatter(n,d.CategoryId,k.getLookup());var o=(0,t.first)(e,n=>n.field===d.CounterpartyCompanyName);return o.referencedFields=[d.CounterpartyId],o.format=n=>this.selectFormatter(n,d.CounterpartyId,E.getLookup()),(0,t.first)(e,n=>n.field===d.UnitPrice).format=i,(0,t.first)(e,n=>n.field==d.UnitPrice).cssClass+=" col-unit-price",(0,t.first)(e,n=>n.field===d.QuantityPerUnit).format=i,(0,t.first)(e,n=>n.field===d.MeasureName).format=a,e}inputsChange(e){var i=this.slickGrid.getCellFromEvent(e),a=this.itemAt(i.row),r=$(e.target),s=r.data("field"),o=(0,t.trimToNull)(r.val()),n=this.pendingChanges[a.WaresId],C=this.getEffectiveValue(a,s),p;r.hasClass("numeric")?p=(0,t.formatNumber)(C,"0.##"):p=C;var l;if(s==="UnitPrice"){if(l=(0,t.parseDecimal)(o!=null?o:""),l==null||isNaN(l)){(0,t.notifyError)((0,t.localText)("Validation.Decimal"),"",null),r.val(p),r.focus();return}}else if(r.hasClass("numeric")){var c=(0,t.parseInteger)(o!=null?o:"");if(isNaN(c)||c>32767||c<0){(0,t.notifyError)((0,t.localText)("Validation.Integer"),"",null),r.val(p),r.focus();return}l=c}else r.is("select")?l=(0,t.toId)(r.val()):l=o;n||(this.pendingChanges[a.WaresId]=n={}),n[s]=l,a[s]=l,this.view.refresh(),r.hasClass("numeric")&&(l=(0,t.formatNumber)(l,"0.##")),r.val(l).addClass("dirty"),this.setSaveButtonState()}setSaveButtonState(){this.toolbar.findButton("apply-changes-button").toggleClass("disabled",Object.keys(this.pendingChanges).length===0)}saveClick(){if(Object.keys(this.pendingChanges).length!==0){var e=Object.keys(this.pendingChanges),i=-1,a=this;m(function r(){if(++i>=e.length){a.refresh();return}var s=e[i],o=(0,t.deepClone)(a.pendingChanges[s]);o.WaresId=s,(0,t.serviceRequest)(h.Methods.Update,{EntityId:s,Entity:o},n=>{delete a.pendingChanges[s],r()})},"saveNext")()}}getQuickFilters(){var e=super.getQuickFilters(),i=(0,t.parseQueryString)();if(i.cat){var a=(0,t.tryFirst)(e,r=>r.field=="CategoryID");a.init=r=>{r.element.getWidget(v.LookupEditor).value=i.cat}}return e}};m(f,"WaresGrid"),f=w([v.Decorators.registerClass(),v.Decorators.filterable()],f);$(function(){(0,W.initFullHeightGridPage)(new f($("#GridDiv")).element)});
//# sourceMappingURL=WaresPage.js.map
