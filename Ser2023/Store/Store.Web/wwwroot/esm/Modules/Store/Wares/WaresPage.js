import{C as P,P as F,R as v,S as y,c as D,i as b,w as k}from"../../../_chunks/chunk-4KERNUBW.js";import{a as c,c as h,d as I,f as w,g as W}from"../../../_chunks/chunk-FEDAVPE7.js";var E=h(w(),1);var g=h(W(),1),t=h(w(),1),C=h(P(),1);var u=v.Fields,m=class extends g.EntityGrid{constructor(e){super(e);this.pendingChanges={};this.slickContainer.on("change",".edit:input",i=>this.inputsChange(i))}getColumnsKey(){return F.columnsKey}getDialogType(){return k}getIdProperty(){return v.idProperty}getInsertPermission(){return v.insertPermission}getLocalTextPrefix(){return v.localTextPrefix}getService(){return y.baseUrl}getButtons(){var e=super.getButtons();return e.push(C.ExcelExportHelper.createToolButton({grid:this,service:y.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),e.push(C.PdfExportHelper.createToolButton({grid:this,onViewSubmit:()=>this.onViewSubmit(),reportTitle:"Wares List",columnTitles:{Discontinued:"Dis."},tableOptions:{columnStyles:{ProductID:{cellWidth:25,halign:"right"},Discountinued:{cellWidth:25}}}})),e.push({title:"Save Changes",cssClass:"apply-changes-button disabled",onClick:i=>this.saveClick(),separator:!0}),e}onViewProcessData(e){return this.pendingChanges={},this.setSaveButtonState(),super.onViewProcessData(e)}numericInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)((0,t.formatNumber)(e.value,"#0.##"));var i="edit numeric",a=e.item,r=this.pendingChanges[a.WaresId];r&&r[e.column.field]!==void 0&&(i+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.##")+"'/>"}moneyInputFormatter(e){var i="edit numeric",a=e.item,r=this.pendingChanges[a.WaresId];r&&r[e.column.field]!==void 0&&(i+=" dirty");var s=this.getEffectiveValue(a,e.column.field);return"<input type='text' style='text - align:right' class='"+i+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(s,"0.0000")+"'/>"}stringInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var i="edit string",a=e.item,r=this.pendingChanges[a.WaresId],s=e.column;r&&r[s.field]!==void 0&&(i+=" dirty");var o=this.getEffectiveValue(a,s.field);return"<input type='text' class='"+i+"' data-field='"+s.field+"' value='"+(0,t.htmlEncode)(o)+"' maxlength='"+s.sourceItem.maxLength+"'/>"}selectFormatter(e,i,a){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var r="edit",s=e.item,o=this.pendingChanges[s.WaresId],n=e.column;o&&o[i]!==void 0&&(r+=" dirty");var f=this.getEffectiveValue(s,i),d="<select class='"+r+"' data-field='"+i+"' style='width: 100%; max-width: 100%'><option value=''>--</option>";for(var l of a.items){let p=l[a.idField];d+="<option value='"+(0,t.htmlEncode)(p)+"'",p==f&&(d+=" selected"),d+=">"+(0,t.htmlEncode)(l[a.textField])+"</option>"}return d+"</select>"}getEffectiveValue(e,i){var a=this.pendingChanges[e.WaresID];return a&&a[i]!==void 0?a[i]:e[i]}getColumns(){var e=super.getColumns(),i=c(n=>this.numericInputFormatter(n),"num"),a=c(n=>this.stringInputFormatter(n),"str"),r=c(n=>this.moneyInputFormatter(n),"mon");(0,t.first)(e,n=>n.field==="QuantityPerUnit").format=a;var s=(0,t.first)(e,n=>n.field===u.CategoryCategoryName);s.referencedFields=[u.CategoryId],s.format=n=>this.selectFormatter(n,u.CategoryId,D.getLookup());var o=(0,t.first)(e,n=>n.field===u.CounterpartyCompanyName);return o.referencedFields=[u.CounterpartyId],o.format=n=>this.selectFormatter(n,u.CounterpartyId,b.getLookup()),(0,t.first)(e,n=>n.field===u.UnitPrice).format=i,(0,t.first)(e,n=>n.field==u.UnitPrice).cssClass+=" col-unit-price",(0,t.first)(e,n=>n.field===u.QuantityPerUnit).format=i,(0,t.first)(e,n=>n.field===u.MeasureName).format=a,e}inputsChange(e){var i=this.slickGrid.getCellFromEvent(e),a=this.itemAt(i.row),r=$(e.target),s=r.data("field"),o=(0,t.trimToNull)(r.val()),n=this.pendingChanges[a.WaresId],f=this.getEffectiveValue(a,s),d;r.hasClass("numeric")?d=(0,t.formatNumber)(f,"0.##"):d=f;var l;if(s==="UnitPrice"){if(l=(0,t.parseDecimal)(o!=null?o:""),l==null||isNaN(l)){(0,t.notifyError)((0,t.localText)("Validation.Decimal"),"",null),r.val(d),r.focus();return}}else if(r.hasClass("numeric")){var p=(0,t.parseInteger)(o!=null?o:"");if(isNaN(p)||p>32767||p<0){(0,t.notifyError)((0,t.localText)("Validation.Integer"),"",null),r.val(d),r.focus();return}l=p}else r.is("select")?l=(0,t.toId)(r.val()):l=o;n||(this.pendingChanges[a.WaresId]=n={}),n[s]=l,a[s]=l,this.view.refresh(),r.hasClass("numeric")&&(l=(0,t.formatNumber)(l,"0.##")),r.val(l).addClass("dirty"),this.setSaveButtonState()}setSaveButtonState(){this.toolbar.findButton("apply-changes-button").toggleClass("disabled",Object.keys(this.pendingChanges).length===0)}saveClick(){if(Object.keys(this.pendingChanges).length!==0){var e=Object.keys(this.pendingChanges),i=-1,a=this;c(function r(){if(++i>=e.length){a.refresh();return}var s=e[i],o=(0,t.deepClone)(a.pendingChanges[s]);o.WaresId=s,(0,t.serviceRequest)(y.Methods.Update,{EntityId:s,Entity:o},n=>{delete a.pendingChanges[s],r()})},"saveNext")()}}getQuickFilters(){var e=super.getQuickFilters(),i=(0,t.parseQueryString)();if(i.cat){var a=(0,t.tryFirst)(e,r=>r.field=="CategoryID");a.init=r=>{r.element.getWidget(g.LookupEditor).value=i.cat}}return e}};c(m,"WaresGrid"),m=I([g.Decorators.registerClass(),g.Decorators.filterable()],m);$(function(){(0,E.initFullHeightGridPage)(new m($("#GridDiv")).element)});
//# sourceMappingURL=WaresPage.js.map
